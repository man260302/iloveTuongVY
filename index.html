<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>I LOVE TƯỜNG VY</title>
  <style>
    html, body {
      margin: 0;
      height: 100%;
      background: black;
      overflow: hidden;
      display: flex;
      justify-content: center;
      align-items: center;
      flex-direction: column;
    }

    /* Trái tim */
    .heart {
      width: 250px;
      height: 250px;
      background-image: url("./images/TuongVy.jpg");
      background-size: cover;
      background-position: center;
      clip-path: path("M 125 225 L 25 125 A 50 50 0 0 1 125 50 A 50 50 0 0 1 225 125 Z");
      border: 5px solid red;
      border-radius: 15px;
      cursor: pointer;
      transition: transform 0.3s ease;
      z-index: 10;
    }
    .heart:hover {
      transform: scale(1.05);
    }

    /* Dòng chữ */
    .message {
      display: none;
      color: white;
      font-size: 3em;
      font-weight: bold;
      margin-top: 20px;
      text-shadow: 0 0 20px red, 0 0 40px pink;
      animation: glow 1s infinite alternate;
      z-index: 10;
    }
    @keyframes glow {
      from { text-shadow: 0 0 10px red, 0 0 20px pink; }
      to   { text-shadow: 0 0 20px red, 0 0 50px pink; }
    }

    canvas {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: 1;
      display: none; /* ẩn canvas cho đến khi click */
    }
  </style>
</head>
<body>
  <div class="heart" id="heart"></div>
  <div class="message" id="message">I LOVE TƯỜNG VY ❤️</div>
  <canvas id="c"></canvas>

  <script>
    const heart = document.getElementById("heart");
    const message = document.getElementById("message");
    const canvas = document.getElementById("c");
    const ctx = canvas.getContext("2d", { alpha: true });
    let started = false;

    let W = canvas.width = innerWidth;
    let H = canvas.height = innerHeight;

    addEventListener("resize", () => {
      W = canvas.width = innerWidth;
      H = canvas.height = innerHeight;
    });

    // Utility
    const rand = (a,b) => Math.random()*(b-a)+a;

    class Particle {
      constructor(x,y,vx,vy,color,life,size,friction=0.99) {
        this.x=x; this.y=y; this.vx=vx; this.vy=vy;
        this.color=color; this.life=life; this.age=0; this.size=size;
        this.friction = friction;
      }
      update(dt) {
        this.vx *= this.friction;
        this.vy *= this.friction;
        this.vy += 0.02 * dt; // gravity
        this.x += this.vx * dt;
        this.y += this.vy * dt;
        this.age += dt;
      }
      get alive() { return this.age < this.life; }
      draw(ctx) {
        const t = Math.max(0, 1 - this.age/this.life);
        ctx.globalAlpha = Math.pow(t, 1.8);
        ctx.beginPath();
        ctx.fillStyle = this.color;
        ctx.arc(this.x, this.y, this.size * t, 0, Math.PI*2);
        ctx.fill();
        ctx.globalAlpha = 1;
      }
    }

    class Rocket {
      constructor(x, y, tx, ty, color) {
        this.x = x; this.y = y;
        const angle = Math.atan2(ty - y, tx - x);
        const speed = rand(6,10);
        this.vx = Math.cos(angle) * speed * rand(0.9,1.1);
        this.vy = Math.sin(angle) * speed * rand(0.9,1.1);
        this.size = 3;
        this.color = color;
        this.exploded = false;
        this.targetY = ty;
      }
      update(dt) {
        this.vy += 0.02 * dt;
        this.x += this.vx * dt;
        this.y += this.vy * dt;
        if (this.vy >= 0 || this.y <= this.targetY) {
          this.exploded = true;
        }
      }
      draw(ctx) {
        ctx.beginPath();
        ctx.fillStyle = this.color;
        ctx.arc(this.x, this.y, this.size, 0, Math.PI*2);
        ctx.fill();
      }
    }

    let rockets = [];
    let particles = [];
    let last = performance.now();
    let running = true;

    function spawnRocket() {
      const startX = rand(W*0.1, W*0.9);
      const startY = H + 10;
      const targetX = rand(W*0.2, W*0.8);
      const targetY = rand(H*0.12, H*0.45);
      const color = `hsl(${rand(0,360)}, 90%, 60%)`;
      rockets.push(new Rocket(startX,startY,targetX,targetY,color));
    }

    function explode(x,y,color, count=80) {
      for (let i=0; i<count; i++) {
        const angle = Math.random()*Math.PI*2;
        const speed = rand(1.5,6);
        const vx = Math.cos(angle)*speed;
        const vy = Math.sin(angle)*speed;
        const life = rand(40,90);
        const size = rand(1,3);
        particles.push(new Particle(x,y,vx,vy,color,life,size, 0.985));
      }
    }

    let spawnTimer = 0;
    function step() {
      const now = performance.now();
      const dt = Math.min(2, (now - last)/16.6667);
      last = now;
      if (!running) { requestAnimationFrame(step); return; }

      ctx.fillStyle = 'rgba(0,0,0,0.18)';
      ctx.fillRect(0,0,W,H);

      for (let i = rockets.length-1; i>=0; i--) {
        const r = rockets[i];
        r.update(dt);
        r.draw(ctx);
        if (r.exploded) {
          explode(r.x, r.y, r.color, Math.round(rand(50,120)));
          rockets.splice(i,1);
        }
      }

      for (let i = particles.length-1; i>=0; i--) {
        const p = particles[i];
        p.update(dt);
        if (!p.alive) {
          particles.splice(i,1);
        } else {
          p.draw(ctx);
        }
      }

      spawnTimer -= dt;
      if (spawnTimer <= 0) {
        const group = Math.random() < 0.5 ? Math.round(rand(2,5)) : 1;
        for (let i=0;i<group;i++){
          spawnRocket();
        }
        spawnTimer = rand(6, 16);
      }

      requestAnimationFrame(step);
    }

    // Khi click vào trái tim
    heart.addEventListener("click", () => {
      heart.style.display = "none"; // ẩn trái tim
      message.style.display = "block";
      canvas.style.display = "block";
      if (!started) {
        started = true;
        requestAnimationFrame(step);
        for (let i=0;i<5;i++) setTimeout(spawnRocket, i*300);
      }
    });
  </script>
</body>
</html>
